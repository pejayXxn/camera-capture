<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Camera Capture</title>
  <style>
    body {
      background: #121212;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }

    #camera-container {
      position: relative;
      width: 90%;
      max-width: 400px;
      border: 8px solid #333;
      border-radius: 20px;
      overflow: hidden;
      background: #000;
    }

    video, canvas {
      width: 100%;
      height: auto;
      border-radius: 12px;
    }

    #controls {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    button {
      padding: 10px 15px;
      background: #444;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background: #666;
    }

    #photos {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .photo-item {
      position: relative;
    }

    .photo-item img {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 10px;
      border: 2px solid white;
    }
  </style>
</head>
<body>

  <div id="camera-container">
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" style="display:none;"></canvas>
  </div>

  <div id="controls">
    <button onclick="capture()">Capture</button>
    <button onclick="toggleBW()">Black & White</button>
    <button onclick="downloadPhoto()">Download</button>
    <button onclick="deletePhotos()">Delete All</button>
    <button onclick="setCollage('normal')">Normal</button>
    <button onclick="setCollage('2box')">2 Box</button>
    <button onclick="setCollage('4box')">4 Box</button>
  </div>

  <div id="photos"></div>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const photos = document.getElementById('photos');
    let isBW = false;
    let collageMode = 'normal';

    // Ask permission and start camera
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        video.srcObject = stream;
      })
      .catch(err => {
        alert("Error accessing camera: " + err);
      });

    function capture() {
      const context = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0, canvas.width, canvas.height);

      if (isBW) {
        let imgData = context.getImageData(0, 0, canvas.width, canvas.height);
        for (let i = 0; i < imgData.data.length; i += 4) {
          let avg = (imgData.data[i] + imgData.data[i+1] + imgData.data[i+2]) / 3;
          imgData.data[i] = imgData.data[i+1] = imgData.data[i+2] = avg;
        }
        context.putImageData(imgData, 0, 0);
      }

      const img = new Image();
      img.src = canvas.toDataURL('image/png');
      const photoItem = document.createElement('div');
      photoItem.className = 'photo-item';
      photoItem.appendChild(img);
      photos.appendChild(photoItem);

      updateCollage();
    }

    function toggleBW() {
      isBW = !isBW;
      alert("Black & White mode: " + (isBW ? "ON" : "OFF"));
    }

    function downloadPhoto() {
      if (photos.lastChild) {
        const a = document.createElement('a');
        a.href = photos.lastChild.querySelector('img').src;
        a.download = 'captured_photo.png';
        a.click();
      } else {
        alert("No photo to download!");
      }
    }

    function deletePhotos() {
      photos.innerHTML = '';
    }

    function setCollage(mode) {
      collageMode = mode;
      updateCollage();
    }

    function updateCollage() {
      if (collageMode === 'normal') {
        photos.style.flexDirection = 'row';
        photos.style.flexWrap = 'wrap';
      } else if (collageMode === '2box') {
        photos.style.flexDirection = 'row';
        photos.style.flexWrap = 'wrap';
        photos.childNodes.forEach(photo => {
          photo.querySelector('img').style.width = 'calc(50vw - 30px)';
          photo.querySelector('img').style.height = 'auto';
        });
      } else if (collageMode === '4box') {
        photos.style.flexDirection = 'row';
        photos.style.flexWrap = 'wrap';
        photos.childNodes.forEach(photo => {
          photo.querySelector('img').style.width = 'calc(25vw - 20px)';
          photo.querySelector('img').style.height = 'auto';
        });
      }
    }
  </script>

</body>
</html>
